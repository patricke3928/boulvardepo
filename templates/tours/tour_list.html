{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>TravelBook Tours</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

* { box-sizing: border-box; }

html, body {
    margin: 0; padding: 0;
    width: 100%; min-height: 100%;
    font-family: 'Poppins', sans-serif;
    background: #0a0a0a;
    color: #fff;
    overflow-x: hidden;
}

canvas#bg {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    pointer-events: none;
}

/* === Градиентные кнопки === */
.gradient-btn {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    background: rgba(109,86,145,0.25);
    color: white;
    backdrop-filter: blur(10px);
    box-shadow: 0 6px 15px rgba(109,86,145,0.4);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}
.gradient-btn::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: linear-gradient(120deg, #9b7fc8, #6d5691, #9b7fc8, #6d5691);
    animation: gradientMove 4s linear infinite;
    z-index: 0;
    opacity: 0.6;
    transform: rotate(45deg);
}
.gradient-btn span { position: relative; z-index: 1; }
.gradient-btn:hover::before { opacity: 1; }
.gradient-btn:hover { transform: translateY(-2px) scale(1.03); }

@keyframes gradientMove {
    0% { transform: rotate(45deg) translate(0, 0); }
    100% { transform: rotate(45deg) translate(50%, 50%); }
}

/* === Верхнее меню === */
.top-right-buttons {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10;
    display: flex;
    gap: 12px;
}

/* === Контейнер и карточки === */
.container { 
    position: relative; 
    z-index: 1; 
    max-width: 1200px; 
    margin: 80px auto 40px; 
    padding: 20px; 
}
.search-bar { 
    display: flex; 
    justify-content: center; 
    margin-bottom: 30px; 
}
.search-bar input[type="text"] {
    width: 300px; padding: 10px 15px;
    border-radius: 12px; border: none;
    font-size: 14px; outline: none;
    background: rgba(255,255,255,0.08);
    color: #fff; backdrop-filter: blur(10px);
}
.search-bar button {
    margin-left: 10px; padding: 10px 18px;
    border-radius: 12px; font-weight: bold; font-size: 14px;
    color: #fff; background: rgba(109,86,145,0.25);
    backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.1);
    cursor: pointer; transition: all 0.3s ease;
}
.search-bar button:hover { 
    background: rgba(155,127,200,0.3); 
    transform: translateY(-2px) scale(1.03); 
}

/* === Карточки туров === */
.tour-cards { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 24px; 
    justify-content: center; 
}
.tour-card { 
    width: 260px; 
    background: rgba(255,255,255,0.08); 
    backdrop-filter: blur(12px);
    border-radius: 20px; 
    overflow: hidden; 
    box-shadow: 0 8px 25px rgba(109,86,145,0.3);
    transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s; 
    opacity:0; 
    transform:translateY(20px); 
}
.tour-card.show { opacity:1; transform:translateY(0); }
.tour-card img { width:100%; height:160px; object-fit:cover; }
.tour-card .content { padding:16px; }
.tour-card h2 { font-size:1.05rem; margin:0 0 8px; color:#fff; }
.tour-card p { font-size:0.9rem; color:#ccc; line-height:1.3; margin:0 0 10px; }
.tour-card .price { font-weight:700; color:#4BB543; margin-bottom:12px; }
.tour-card .buttons { display:flex; gap:10px; }
.tour-card .buttons a { 
    flex:1; text-align:center; padding:10px 0; border-radius:12px; 
    font-weight:700; text-decoration:none;
    color:#fff; background: rgba(109,86,145,0.25); 
    backdrop-filter: blur(10px); box-shadow: 0 6px 15px rgba(109,86,145,0.4);
    border:1px solid rgba(255,255,255,0.1); 
    transition:all 0.3s ease; 
}
.tour-card .buttons a:hover { 
    background: rgba(155,127,200,0.3); 
    transform: translateY(-2px) scale(1.03); 
}

@media(max-width:768px){ .tour-card{ width:90%; } }
</style>
</head>
<body>

<canvas id="bg"></canvas>

<div class="top-right-buttons">
    <a href="{% url 'blog:list' %}" class="gradient-btn"><span>Blog</span></a>
    {% if user.is_authenticated %}
        <a href="{% url 'users:profile' %}" class="gradient-btn"><span>Profile</span></a>
        <a href="{% url 'users:logout' %}" class="gradient-btn"><span>Logout</span></a>
    {% else %}
        <a href="{% url 'users:login' %}" class="gradient-btn"><span>Login</span></a>
    {% endif %}
</div>

<div class="container">
    <div class="search-bar">
        <input type="text" id="tourSearch" placeholder="Search tours...">
        <button type="button" id="searchBtn">Search</button>
    </div>

    <div class="tour-cards" id="toursContainer">
        {% include 'tours/partials/tour_cards.html' %}
    </div>
</div>

<script>
// === Canvas Background ===
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; 
canvas.height = innerHeight;

const particles=[]; 
const COUNT=120; 
const MAX_DIST=150;

class Particle{ 
    constructor(){this.reset();} 
    reset(){this.x=Math.random()*canvas.width;this.y=Math.random()*canvas.height;this.vx=(Math.random()-0.5)*1.2;this.vy=(Math.random()-0.5)*1.2;this.size=Math.random()*3+1;} 
    update(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>canvas.width)this.vx*=-1;if(this.y<0||this.y>canvas.height)this.vy*=-1;} 
    draw(){ctx.beginPath();ctx.arc(this.x,this.y,this.size,0,Math.PI*2);ctx.fillStyle='rgba(109,86,145,0.8)';ctx.fill();}
}

for(let i=0;i<COUNT;i++)particles.push(new Particle());

function animate(){
    ctx.fillStyle='rgba(10,10,10,0.1)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<particles.length;i++){
        const p1=particles[i];
        p1.update();
        p1.draw();
        for(let j=i+1;j<particles.length;j++){
            const p2=particles[j];
            const dx=p1.x-p2.x,dy=p1.y-p2.y;
            const dist=Math.sqrt(dx*dx+dy*dy);
            if(dist<MAX_DIST){
                ctx.beginPath();
                ctx.strokeStyle=`rgba(155,127,200,${1-dist/MAX_DIST})`;
                ctx.lineWidth=1;
                ctx.moveTo(p1.x,p1.y);
                ctx.lineTo(p2.x,p2.y);
                ctx.stroke();
            }
        }
    }
    requestAnimationFrame(animate);
}
animate();
window.addEventListener('resize',()=>{
    canvas.width=innerWidth;
    canvas.height=innerHeight;
});

// === Cards Animation ===
window.addEventListener('load', ()=>{
    const cards=document.querySelectorAll('.tour-card');
    cards.forEach((card,i)=> setTimeout(()=>card.classList.add('show'), i*150));
});

// === AJAX Search ===
const searchInput = document.getElementById('tourSearch');
const searchBtn = document.getElementById('searchBtn');
const toursContainer = document.getElementById('toursContainer');

function renderTours(tours) {
    if (!tours.length) {
        toursContainer.innerHTML = `<p style="color:#aaa;text-align:center;">No tours found.</p>`;
        return;
    }

    toursContainer.innerHTML = tours.map(t => `
        <div class="tour-card">
            <img src="${t.image}" alt="${t.title}">
            <div class="content">
                <h2>${t.title}</h2>
                <p>${t.description}</p>
                <div class="price">$${t.price}</div>
                <div class="buttons">
                    <a href="/tours/${t.id}/">Details</a>
                    <a href="/tours/${t.id}/book/">Book</a>
                </div>
            </div>
        </div>
    `).join('');

    const cards = toursContainer.querySelectorAll('.tour-card');
    cards.forEach((card, i) => setTimeout(() => card.classList.add('show'), i * 150));
}

function performSearch() {
    const query = searchInput.value.trim();
    fetch(`/search/?q=${encodeURIComponent(query)}`, {
        headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(res => res.json())
    .then(data => renderTours(data.tours))
    .catch(err => console.error('Search error:', err));
}

searchBtn.addEventListener('click', performSearch);
searchInput.addEventListener('input', () => {
    if (searchInput.value.trim() === '') performSearch();
});
</script>

</body>
</html>
