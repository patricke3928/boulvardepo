{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blog - TravelBook</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<style>
body { margin:0; font-family:'Poppins',sans-serif; background:#0b0b0b; color:white; overflow-x:hidden; }
canvas#bgCanvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
.navbar { display:flex; justify-content:flex-end; gap:15px; padding:20px 50px; background:rgba(255,255,255,0.08); backdrop-filter:blur(12px); border-bottom:1px solid rgba(255,255,255,0.1); }
.navbar a { color:white; text-decoration:none; font-weight:500; padding:8px 16px; border-radius:8px; transition:0.3s; }
.navbar a:hover { background: rgba(255,255,255,0.15); }
.vault-container { width:90%; max-width:1200px; margin:40px auto; display:grid; grid-template-columns:repeat(auto-fit, minmax(320px,1fr)); gap:25px; }
.card { background: rgba(255,255,255,0.08); backdrop-filter: blur(15px); border-radius:16px; padding:20px; transition: transform 0.3s, background 0.3s; display:flex; flex-direction:column; }
.card:hover { transform: translateY(-6px); background: rgba(255,255,255,0.12); }
.card h2 { margin-top:0; font-size:22px; }
.card p { color:#d0d0d0; margin-bottom:10px; }
.card .author { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
.card .author img { width:32px; height:32px; border-radius:50%; object-fit:cover; }
.btn { display:inline-block; background: rgba(255,255,255,0.15); padding:10px 20px; border-radius:10px; color:white; text-decoration:none; transition:0.3s; }
.btn:hover { background: rgba(255,255,255,0.3); }
.placeholder { width:100%; height:180px; background:#333; border-radius:10px; display:flex; justify-content:center; align-items:center; color:#aaa; font-size:16px; margin-bottom:10px; }
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<div class="navbar">
    {% if user.is_authenticated %}
        <a href="{% url 'users:profile' %}">Profile</a>
        <a href="{% url 'users:logout' %}">Logout</a>
        <a href="{% url 'blog:form' %}" class="btn">Add New Post</a>
    {% else %}
        <a href="{% url 'users:login' %}">Login</a>
    {% endif %}
    <a href="{% url 'blog:list' %}">Blog</a>
</div>

<div class="vault-container">
    {% for post in posts %}
    <div class="card">
        <!-- Автор -->
        <div class="author">
            {% if post.owner.profile.avatar %}
                <img src="{{ post.owner.profile.avatar.url }}" alt="{{ post.owner.username }}">
            {% else %}
                <img src="{% static 'images/default-avatar.png' %}" alt="Default Avatar">
            {% endif %}
            <span>{{ post.owner.username }}</span>
        </div>

        <!-- Превью -->
        {% if post.preview_image %}
            <img src="{{ post.preview_image.url }}" alt="{{ post.title }}" style="border-radius:12px; margin-bottom:10px;">
        {% elif post.video_url %}
            <div class="placeholder">Video Preview</div>
        {% else %}
            <div class="placeholder">No Preview</div>
        {% endif %}

        <h2>{{ post.title }}</h2>
        <p>{{ post.description|truncatechars:100 }}</p>
        <a href="{% url 'blog:detail' post.pk %}" class="btn">Read More</a>
    </div>
    {% empty %}
        <p>No posts yet.</p>
    {% endfor %}
</div>

<script>
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;

const particles = Array.from({length:80},() => ({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*2+1,
    dx: (Math.random()-0.5)*0.8,
    dy: (Math.random()-0.5)*0.8
}));

function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle="rgba(255,255,255,0.6)";
        ctx.fill();
        p.x+=p.dx; p.y+=p.dy;
        if(p.x<0||p.x>canvas.width) p.dx*=-1;
        if(p.y<0||p.y>canvas.height) p.dy*=-1;
    });
    requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>
