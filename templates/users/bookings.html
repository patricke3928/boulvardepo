{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Your Bookings - TravelBook Tours</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

body { background:#0a0a0a; color:#fff; font-family:'Poppins',sans-serif; padding:30px; margin:0; overflow-x: hidden; position: relative; }
canvas#bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
h2 { margin-bottom:20px; color:#fff; text-align:center; position: relative; z-index: 1; }

.booking-card { background: rgba(255,255,255,0.05); padding:20px; margin-bottom:15px; border-radius:15px; opacity:0; transform: translateY(20px); animation: fadeInUp 0.6s forwards; position: relative; z-index: 1; }
.booking-card h3 { margin:0 0 10px 0; color:#6d5691; }
.booking-card p { margin: 5px 0; color:#ccc; }

.cancel-booking-btn { padding: 8px 14px; border-radius: 8px; border: none; background: rgba(200,50,50,0.7); color: #fff; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
.cancel-booking-btn:hover { background: rgba(255,50,50,0.9); }

.booking-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(109,86,145,0.5); transition: all 0.3s ease; }

@keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

.back-profile-btn { display: inline-block; margin: 20px auto 0 auto; padding: 12px 25px; font-weight: bold; font-size: 16px; text-align: center; color: #fff; text-decoration: none; border-radius: 15px; background: rgba(109, 86, 145, 0.25); backdrop-filter: blur(10px); box-shadow: 0 8px 20px rgba(109, 86, 145, 0.4); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; opacity: 0; transform: translateY(20px); animation: fadeInUp 0.6s forwards; }
.back-profile-btn:hover { background: rgba(155, 127, 200, 0.3); box-shadow: 0 12px 25px rgba(155, 127, 200, 0.6); transform: translateY(-3px) scale(1.05); }

/* Modal */
.modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
.modal-content { background: rgba(255,255,255,0.1); padding: 25px; border-radius: 20px; text-align: center; max-width: 400px; color: #fff; }
.modal-content h3 { margin-bottom: 15px; color:#ff6961; }
.reason-btn { padding: 10px 15px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: rgba(200,50,50,0.7); color: #fff; transition: 0.3s; }
.reason-btn:hover { background: rgba(255,50,50,0.9); }

</style>
</head>
<body>
<canvas id="bg"></canvas>

<h2>Your Bookings</h2>
{% if bookings %}
    {% for b in bookings %}
    <div class="booking-card">
        <h3>{{ b.tour.title }}</h3>
        <p>Check-in: {{ b.check_in }}</p>
        <p>Check-out: {{ b.check_out }}</p>
        <p>Guests: {{ b.guests }}</p>
        <p>Booked on: {{ b.created_at|date:"M d, Y H:i" }}</p>

        <button class="cancel-booking-btn" data-booking-id="{{ b.id }}">Cancel Booking</button>
    </div>
    {% endfor %}
{% else %}
    <p>You have no bookings yet. <a href="{% url 'users:user_bookings' %}">Book a tour now!</a></p>
{% endif %}

<a class="back-profile-btn" href="{% url 'users:profile' %}">&larr; Back to Profile</a>


<div class="modal" id="confirmModal">
    <div class="modal-content">
        <h3>Select a reason for cancellation:</h3>
        <form id="modalForm" method="POST">
            {% csrf_token %}
            <input type="hidden" name="reason" id="cancelReason">
            <button type="button" class="reason-btn" data-reason="Change of plans">Change of plans</button>
            <button type="button" class="reason-btn" data-reason="Found a better deal">Found a better deal</button>
            <button type="button" class="reason-btn" data-reason="Scheduling conflict">Scheduling conflict</button>
            <button type="button" class="reason-btn" data-reason="Health reasons">Health reasons</button>
            <button type="button" class="reason-btn" data-reason="Financial reasons">Financial reasons</button>
            <button type="button" class="reason-btn" data-reason="Other">Other</button>
        </form>
    </div>
</div>

<script>

const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
const particles = [];
const PARTICLE_COUNT = 100;
const MAX_DISTANCE = 150;
class Particle {
    constructor() { this.reset(); }
    reset() { this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.vx = (Math.random() - 0.5) * 1.5; this.vy = (Math.random() - 0.5) * 1.5; this.size = Math.random() * 3 + 1; this.color = `hsl(${Math.random()*360}, 60%, 70%)`; }
    update() { this.x += this.vx; this.y += this.vy; if(this.x<0||this.x>canvas.width)this.vx*=-1;if(this.y<0||this.y>canvas.height)this.vy*=-1; }
    draw() { ctx.beginPath(); ctx.arc(this.x,this.y,this.size,0,Math.PI*2); ctx.fillStyle=this.color; ctx.fill(); }
}
for (let i=0;i<PARTICLE_COUNT;i++) particles.push(new Particle());
function animate() {
    ctx.fillStyle = 'rgba(10,10,10,0.2)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<particles.length;i++){ const p1=particles[i]; p1.update(); p1.draw();
        for(let j=i+1;j<particles.length;j++){ const p2=particles[j]; const dx=p1.x-p2.x; const dy=p1.y-p2.y; const dist=Math.sqrt(dx*dx+dy*dy);
            if(dist<MAX_DISTANCE){ ctx.beginPath(); ctx.strokeStyle=`rgba(155,127,200,${1-dist/MAX_DISTANCE})`; ctx.lineWidth=1; ctx.moveTo(p1.x,p1.y); ctx.lineTo(p2.x,p2.y); ctx.stroke(); }
        }
    }
    requestAnimationFrame(animate);
}
animate();
window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight;});


const modal = document.getElementById('confirmModal');
const modalForm = document.getElementById('modalForm');
const cancelReasonInput = document.getElementById('cancelReason');
const modalCancel = document.getElementById('modalCancel');

document.querySelectorAll('.cancel-booking-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
        const bookingId = btn.getAttribute('data-booking-id');
        modalForm.action = "{% url 'users:cancel_booking' 0 %}".replace('0', bookingId);
        modal.style.display = 'flex';
    });
});

document.querySelectorAll('.reason-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
        cancelReasonInput.value = btn.getAttribute('data-reason');
        modalForm.submit();
    });
});

modalCancel.addEventListener('click',()=>{ modal.style.display='none'; });
window.addEventListener('click',(e)=>{ if(e.target==modal) modal.style.display='none'; });
</script>

</body>
</html>
